fragment OfflineTilePackageDetails on OfflineTilePackage {
  id
  bytes
  projectId
  region {
    geojson
  }
  sourceType
  jobStatus
  tilesFetched
  totalTiles
  createdAt
  jobErrors
  dataSourceUrl
  isMapboxHosted
  maxZ
  maxShorelineZ
  presignedUrl
}

fragment OfflineBasemapDetails on Basemap {
  ...BasemapDetails
  useDefaultOfflineTileSettings
  offlineTileSettings {
    basemapId
    id
    maxShorelineZ
    maxZ
  }
}

fragment OfflineTileSettingsForCalculation on OfflineTileSetting {
  maxShorelineZ
  maxZ
}

query OfflineSurveyMaps($slug: String!) {
  projectBySlug(slug: $slug) {
    region {
      geojson
    }
    mapboxPublicKey
    id
    offlineTileSettings {
      maxShorelineZ
      maxZ
      basemapId
    }
    surveys {
      id
      name
      form {
        id
      }
      basemaps {
        ...OfflineBasemapDetails
      }
    }
    offlineTilePackagesConnection {
      nodes {
        ...OfflineTilePackageDetails
      }
    }
  }
}

mutation ToggleOfflineBasemapSupport($id: Int!, $enable: Boolean!) {
  updateBasemap(input: { id: $id, patch: { isOfflineEnabled: $enable } }) {
    basemap {
      id
      isOfflineEnabled
    }
  }
}

fragment OfflineTileSettings on OfflineTileSetting {
  id
  projectId
  basemapId
  maxZ
  maxShorelineZ
  region {
    geojson
  }
}

query BasemapOfflineSettings($id: Int!, $slug: String!) {
  projectBySlug(slug: $slug) {
    id
    mapboxPublicKey
    region {
      geojson
    }
    offlineTileSettings {
      ...OfflineTileSettings
    }
  }

  basemap(id: $id) {
    id
    name
    url
    isOfflineEnabled
    useDefaultOfflineTileSettings
    project {
      id
      region {
        geojson
      }
    }
  }
}

mutation UpdateBasemapOfflineTileSettings(
  $projectId: Int!
  $maxZ: Int!
  $maxShorelineZ: Int
  $basemapId: Int!
  $useDefault: Boolean!
) {
  updateBasemapOfflineTileSettings(
    input: {
      basemapId: $basemapId
      maxShorelineZ: $maxShorelineZ
      maxZ: $maxZ
      projectId: $projectId
      useDefault: $useDefault
    }
  ) {
    basemap {
      id
      useDefaultOfflineTileSettings
      project {
        id
        offlineTileSettings {
          ...OfflineTileSettings
        }
      }
    }
  }
}

mutation generateOfflineTilePackage(
  $dataSourceUrl: String!
  $projectId: Int!
  $maxZ: Int!
  $maxShorelineZ: Int
  $sourceType: OfflineTilePackageSourceType
) {
  generateOfflineTilePackage(
    input: {
      dataSourceUrl: $dataSourceUrl
      projectId: $projectId
      maxZ: $maxZ
      maxShorelineZ: $maxShorelineZ
      sourceType: $sourceType
    }
  ) {
    offlineTilePackage {
      ...OfflineTilePackageDetails
    }
  }
}

mutation deleteTilePackage($id: UUID!) {
  deleteOfflineTilePackage(input: { id: $id }) {
    offlineTilePackage {
      id
    }
  }
}

query getTilePackage($id: UUID!) {
  offlineTilePackage(id: $id) {
    ...OfflineTilePackageDetails
  }
}
